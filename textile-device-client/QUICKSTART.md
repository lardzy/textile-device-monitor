# 纺织品检测设备客户端 - 快速开始

## 1. 环境准备

### Windows 运行时库

客户端依赖 PyQt6，需要安装 Visual C++ Redistributable：

**下载地址**：
```
https://learn.microsoft.com/en-us/cpp/windows/latest-supported-vc-redist
```

下载并安装：
- Microsoft Visual C++ 2015-2022 Redistributable (x64)

## 2. 安装和运行

### 方式一：使用安装包（推荐）

1. **打包程序**
   ```bash
   cd textile-device-client
   pip install pyinstaller
   python build.py
   ```

2. **安装到 Windows**
   ```bash
   install.bat
   ```

3. **首次运行**
   - 双击桌面快捷方式
   - 配置窗口自动弹出
   - 填写配置信息
   - 点击确定

### 方式二：开发环境运行

1. **安装依赖**
   ```bash
   cd textile-device-client
   pip install -r requirements.txt
   ```

2. **运行程序**
   ```bash
   python main.py
   ```

## 3. 配置说明

### 首次配置

| 配置项 | 说明 | 示例 |
|--------|------|------|
| **设备编码** | 设备唯一标识 | 1号-8号 或 自定义名称 |
| **设备名称** | 设备显示名称 | 1号设备 |
| **服务器地址** | 服务器 API 地址 | http://192.168.1.100:8000 |
| **进度文件路径** | 网络共享路径 | \\\\192.168.105.66\\...\\AI显微镜检测进度(重要勿删) |
| **上报间隔** | 状态上报间隔（秒） | 5 |

### 配置示例

```
设备编码：1号
设备名称：1号设备
服务器地址：http://192.168.1.100:8000
进度文件路径：\\192.168.105.66\17检验八部\10特纤\02-检验\其他\AI显微镜检测进度(重要勿删)
上报间隔：5秒
```

## 4. 日常使用

### 托盘操作

右键点击系统托盘图标：

| 菜单项 | 功能 |
|--------|------|
| 打开配置 | 修改设备配置 |
| 维护模式 | 切换到维护状态（停止上报） |
| 正常模式 | 恢复正常上报 |
| 查看日志 | 打开日志查看窗口 |
| 重新连接 | 重新连接服务器 |
| 退出 | 退出程序 |

### 托盘图标说明

| 颜色 | 状态 | 说明 |
|------|------|------|
| 🟢 绿色 | idle | 设备空闲 |
| 🔵 蓝色 | busy | 设备正在检测 |
| 🟠 橙色 | maintenance | 维护模式 |
| 🔴 红色 | error | 错误状态 |
| ⚪ 灰色 | offline | 离线 |

## 5. 进度文件说明

### 文件位置

```
\\192.168.105.66\17检验八部\10特纤\02-检验\其他\AI显微镜检测进度(重要勿删)\{设备名}\result.txt
```

### 文件格式

文件内容为单个整数（0-100），代表检测进度：

```
75
```

### 设备类型

- **预设设备**（1号-8号）：从共享文件读取进度
- **自定义设备**：进度固定为 100（因为缺少数据源）

## 6. 修改配置

### 方法一：托盘菜单

1. 右键托盘图标
2. 选择"打开配置"
3. 修改配置
4. 点击确定

### 方法二：编辑配置文件

配置文件位置：
```
C:\Program Files\TextileDeviceClient\config.json
```

编辑后重启程序生效。

## 7. 查看日志

### 方法一：托盘菜单

1. 右键托盘图标
2. 选择"查看日志"

### 方法二：查看日志文件

日志文件位置：
```
C:\Program Files\TextileDeviceClient\logs\client.YYYYMMDD.log
```

### 日志级别

- **DEBUG**：调试信息
- **INFO**：正常信息（默认）
- **WARNING**：警告信息
- **ERROR**：错误信息

## 8. 常见问题

### Q: 程序无法启动，提示 ImportError: DLL load failed

**A**: 安装 Visual C++ Redistributable
```
https://learn.microsoft.com/en-us/cpp/windows/latest-supported-vc-redist
```

### Q: 无法连接服务器

**A**:
1. 检查服务器地址是否正确
2. 用浏览器访问服务器地址测试
3. 检查防火墙设置

### Q: 进度文件读取失败

**A**:
1. 检查网络共享路径配置
2. 确认有访问权限
3. 检查文件是否存在

### Q: 设备状态不更新

**A**:
1. 检查托盘图标是否显示
2. 查看日志文件
3. 右键托盘选择"重新连接"

### Q: 如何卸载程序

**A**: 运行卸载脚本
```bash
uninstall.bat
```

## 9. 维护操作

### 进入维护模式

1. 右键托盘图标
2. 选择"维护模式"
3. 图标变为橙色
4. 状态固定为 maintenance

### 退出维护模式

1. 右键托盘图标
2. 选择"正常模式"
3. 图标恢复正常颜色
4. 状态自动判断

### 重启程序

1. 右键托盘图标
2. 选择"退出"
3. 双击桌面快捷方式重新启动

## 10. 验证程序运行

### 检查进程

打开任务管理器，查看是否有 `textile-device-client.exe` 进程。

### 检查托盘

查看系统托盘区域，应该看到客户端图标。

### 检查日志

查看最新日志文件，确认有上报记录。

### 检查服务器

在服务器端查看设备状态是否更新。

## 11. 故障排查流程

### 步骤1：检查程序运行

```batch
tasklist | findstr textile-device-client
```

### 步骤2：查看日志

打开日志文件，查看最新错误信息。

### 步骤3：测试网络连接

```batch
ping 192.168.1.100
```

### 步骤4：测试服务器

用浏览器访问服务器地址：
```
http://192.168.1.100:8000/health
```

### 步骤5：检查配置

确认 `config.json` 配置正确。

### 步骤6：重新安装

如果问题依旧，卸载后重新安装。

## 12. 联系支持

如遇到问题无法解决，请：
1. 查看日志文件收集错误信息
2. 检查服务器端日志
3. 联系系统管理员

---

**快速链接**：
- [完整功能说明](FEATURES.md)
- [部署指南](DEPLOY.md)
- [README](README.md)
